# –õ–∞–±–∞ 2

–ò–∑ —Ç–æ–≥–æ —á—Ç–æ —è –ø—Ä–æ—á–∏—Ç–∞–ª, —á—Ç–æ –µ—Å—Ç—å –Ω–∞ —Å–∞–π—Ç–µ –¥–æ–∫–µ—Ä–∞ (–±—É–∫–≤–∞–ª—å–Ω–æ –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª best practices), –≤ –æ—à–∏–±–æ–∫–∞—Ö –ª–∏–Ω—Ç–µ—Ä–∞ hadolint –∏ –≤ –æ—Ç–≤–µ—Ç–µ –¥—Ä—É–≥–æ–≥–æ —Å–∏–Ω–µ–≥–æ –∫–∏—Ç–∞ –≤—Å–µ best practices —Å–≤–æ–¥—è—Ç—Å—è –∫ —Ç—Ä–µ–º –≤–µ—â–∞–º:

* –ò–∑–±–µ–≥–∞—Ç—å –ª–∏—à–Ω–µ–≥–æ
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

–ü–µ—Ä–≤–æ–µ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏. –í—Ç–æ—Ä–æ–µ –Ω–µ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ—á—Ç–∏ –≤–µ–∑–¥–µ. –¢—Ä–µ—Ç—å–µ –µ—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å —á—Ç–æ–±—ã —Ç–µ–±—è —É–≤–æ–ª–∏–ª–∏ –∑–∞ —É—â–µ—Ä–± –≤ –º–∏–ª–ª–∏–æ–Ω—ã —Ä—É–±–ª–µ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ–¥–∞ —É–ø–∞–ª–∞ –∏–∑-–∑–∞ –ø–∞—Ç—á–∞ –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–º–µ–Ω—è–ª—Å—è –æ–¥–∏–Ω –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö.

## –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
–ò–∑ –ø—Ä–∞–∫—Ç–∏—Ç–∫ –¥–ª—è –æ—Ç—Å—É—Ç–≤–∏—è –Ω–µ–Ω—É–∂–Ω–æ–≥–æ:

* Multi-Stage —Å–±–æ—Ä–∫–∞ —á—Ç–æ–±—ã –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ —á—Ç–æ –Ω—É–∂–Ω–æ
* –°—Ç–∞—Ä–∞—Ç—å—Å—è –≤ –º–µ–Ω—å—à–µ –∫–æ–º–∞–Ω–¥ (–ö–æ–º–∞–Ω–¥—ã —ç—Ç–æ "—Å–ª–æ–∏" –∫–æ—Ç–æ—Ä—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è) 
* –í—Ü–µ–ª–æ–º —á–∏—Å—Ç–∏—Ç—å –∫—ç—à –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∏ –º—É—Å–æ—Ä –≤ –¥–æ–º–µ —Ç–æ–∂–µ)

–ò–∑ –ø—Ä–∞–∫—Ç–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

* –ë–æ–≥–∞ —Ä–∞–¥–∏ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å API –∫–ª—é—á–∏ –∏ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏
* –î–∞–∂–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ root –Ω–µ–∑—è (–ù–µ —Å—Ç–æ–∏—Ç –¥–∞–≤–∞—Ç—å –∏–∑–ª–∏—à–Ω–∏–∏ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
* –ü–∞–∫–µ—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

–ò–∑ –ø—Ä–∞–∫—Ç–∏–∫ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:

* –í–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤ —è–≤–Ω–æ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π (–ï—Å–ª–∏ –Ω–∞–¥–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –æ–¥–∏–Ω –∏–∑ update'–æ–≤)
* –ê –≤ —Ü–µ–ª–æ–º –Ω–µ–∑–Ω–∞—é —á—Ç–æ –µ—â—ë

## –ü–æ–≥–Ω–∞–ª–∏ –ø–∏—Å–∞—Ç—å –∫–∞–ªü•∞üòùüòé

–Ø –ø–æ–ø—Ä–æ—Å–∏–ª  –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —Å–∏–Ω–µ–≥–æ –±—Ä–∞—Ç–∞ —Å–≥–µ–Ω–∏—Ä–∏—Ç—å –ø–ª–æ—Ö–æ–π —Ñ–∞–π–ª –∏ —Ç–æ —á—Ç–æ –æ–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —ç—Ç–æ ***Absolute Cinema***. –ê –≤–æ—Ç –∏ –Ω–∞—à –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –ø–æ–∑–æ—Ä –≥–æ–¥–∞ 
```dockerfile
FROM ubuntu:latest 

RUN apt-get update
RUN apt-get upgrade -y
RUN apt-get install -y wget curl git vim nano emacs 

RUN apt-get install -y gcc
RUN apt-get install -y g++
RUN apt-get install -y build-essential

RUN mkdir /app
RUN mkdir /app/src
RUN mkdir /app/build
RUN mkdir /app/output

COPY . /app/src/

WORKDIR /app/src
WORKDIR /app/build
WORKDIR /app/src

RUN g++ -g -O0 main.cpp -o /app/output/hello

WORKDIR /app/output

CMD ["./hello"]

EXPOSE 8080  
```
–ò –ø–æ–º–æ–µ–º—É –æ–Ω –Ω–µ–º–Ω–æ–≥–æ –±–∞—Ä—â–∞–Ω—É–ª. –ù–∞—á–∏–Ω–∞—è –æ—Ç –∫–∞–∫–æ–≥–æ –ø—Ä–æ—Å—Ç–æ –±–µ–∑—É–º–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤ –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞üíÄ
–ò–∑ –ø–ª–æ—Ö–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –≤—ã–±—Ä–∞–Ω —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑, –Ω–µ —É–∫–∞–∑–∞–Ω–∞ —è–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤ –∏ –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–µ –Ω—É–∂–Ω—ã—Ö, –±–∏–Ω–∞—Ä–Ω–∏–∫ –∑–∞–ø—É—â–µ–Ω –∏–∑ –ø–æ–¥ root'–∞, –∏ –≤–ø–æ–ª–Ω–µ –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–¥–µ–ª–∞—Ç—å multi-stage 

–í–ø—Ä–∏–Ω—Ü–∏–ø–µ —ç—Ç–æ —á—É–¥–æ –ø–æ –≤–µ—Å—É –º–æ–∂–µ—Ç —Å–ø–æ–∫–æ–π–Ω–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç—Å—è —Å–æ —Å—Ä–µ–¥–Ω–µ—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º –∂–∏—Ç–µ–ª–µ–º –∞–º–µ—Ä–∏–∫–∏
![](rice2.png)
–°–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤—Å–µ —Ç–æ–∂–µ –¥–æ–≤–æ–ª—å–Ω–æ –¥–æ–ª–≥–æ
![](rice1.png)


## –ò—Å–ø—Ä–∞–≤–ª—è–µ–ºü´°
```dockerfile
FROM gcc:11-bullseye as builder

COPY main.cpp .
RUN g++ main.cpp -static -o hello

FROM scratch
COPY --from=builder /hello /hello
CMD ["./hello"]
```
–ü–æ–º–µ–Ω—è–ª–æ—Å—å –±—É–∫–≤–∞–ª—å–Ω–æ –≤—Å–µ... –Ω–∞—á–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –æ–ø—Ç–∏–º–∞–ª–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º—Å—è –∏–∑ –ø–æ–¥ scratch, –ª–∏—à–Ω–∏—Ö —Å–ª–æ–µ–≤ –Ω–µ—Ç—É —è —Å—á–∏—Ç–∞—é —ç—Ç–æ –ø–æ–ª–Ω—ã–π –≥–æ–ª
–ü–æ –≤–µ—Å—É –≤—Å–µ —Ç–µ–ø–µ—Ä—å –ø–æ –º–æ–µ–º—É –∑–¥—Ä–∞–≤–æ
![](rice4.png)
–ù—É –∞ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –µ—Å–ª–∏ –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º —á—Ç–æ –≤ –ø—Ä–æ—à–ª–æ–º —á—Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å—ä–µ–ª–∞ —Å–∫–∞—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–æ –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω–∞ —Å–∫–∞—á–∫—É —É—à–ª–æ 200—Å–µ–∫
![](rice3.png)

## –ü–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

* –î–µ–ª–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º–∏ –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ –∑–∞–º–µ–Ω—ã (–¢–æ –µ—Å—Ç—å –Ω–µ [Ephemeral](https://docs.docker.com/build/building/best-practices/#create-ephemeral-containers$0) –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)
* –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏–∑ –ø–æ–¥ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–£–±–∏–≤–∞–µ—Ç –∏–¥–µ—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å)
